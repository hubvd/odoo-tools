#!/usr/bin/fish

set pycharm_dir ~/.local/share/JetBrains/Toolbox/apps/PyCharm-P/ch-0
set pycharm_latest_version (
   path dirname $pycharm_dir/*/bin/pycharm.sh |
   path dirname |
   path basename |
   sort -t . -k1,1n -k2,2n -k3,3n |
   tail -1
)
set pycharm_bin $pycharm_dir/$pycharm_latest_version/bin/pycharm.sh

if not test -f $pycharm_bin
    notify-send (basename $i)" moved"
    exit 1
end

function open
    setsid $pycharm_bin $argv &>/dev/null &
end

if set -q argv[1]
    set parts (string split '#' -- (string replace -r '\.pycharm$' '' -- $argv[1]))
    if set -q parts[2]
        open --line $parts[2] $parts[1]
    else
        open $parts[1]
    end
    exit $status
end

set choice (worktree path) || set choice (worktree paths | bemenu -p pycharm)

if test -d "$choice"
    open $choice
else
    exit 1
end
